---
layout: none
---

<head>
    <title>Blobs</title>
    {% include favicon.html %}
</head>

<style>
    canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
</style>

<canvas id="canv"></canvas>

<script>
    const canvas = document.getElementById("canv");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const blobs = [
        { x: 200, y: 200, r: 100, dx: 1, dy: 0.7 },
        { x: 400, y: 300, r: 200, dx: -2, dy: -0.5 },
        { x: 100, y: 320, r: 250, dx: -2, dy: -0.5 },
        { x: 300, y: 480, r: 50, dx: -2, dy: -0.5 },
        { x: 400, y: 100, r: 75, dx: -2, dy: -0.5 },
    ];

    const threshold = 1.0;

    function field(x, y) {
        let sum = 0;
        for (const b of blobs) {
            let dx = x - b.x;
            let dy = y - b.y;
            sum += (b.r * b.r) / (dx * dx + dy * dy + 1); // +1 to avoid div by 0
        }
        return sum;
    }

    function drawMetaballs() {
        const img = ctx.createImageData(canvas.width, canvas.height);
        const data = img.data;

        for (let y = 0; y < canvas.height; y += 2) {
            for (let x = 0; x < canvas.width; x += 2) {
                const v = field(x, y);
                const idx = (y * canvas.width + x) * 4;
                if (v > threshold) {
                    data[idx] = 100;   // R
                    data[idx + 1] = 180; // G
                    data[idx + 2] = 255; // B
                    data[idx + 3] = 255; // A
                } else {
                    data[idx + 3] = 0;   // Transparent
                }
            }
        }
        ctx.putImageData(img, 0, 0);
    }

    function update() {
        for (const b of blobs) {
            b.x += b.dx;
            b.y += b.dy;
            if (b.x - b.r < 0 || b.x + b.r > canvas.width) b.dx *= -1;
            if (b.y - b.r < 0 || b.y + b.r > canvas.height) b.dy *= -1;
        }
    }

    function animate() {
        update();
        drawMetaballs();
        requestAnimationFrame(animate);
    }

    animate();
</script>